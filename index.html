<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scrub Sync Test</title>
  <style>
    html,body{overflow:hidden;margin:0;padding:0;background:#000}
    video { width:100%; height:auto; display:block; }
    #scrubber, #scrubber2{
      position:fixed; bottom:20px; left:10%; right:10%; height:20px;
      background:rgba(255,0,0,0.2);
      cursor: ew-resize; z-index:1000;
    }
    #scrubber2 { bottom:60px; background:rgba(0,0,0,0); }
    .scrubber__fill{height:100%;background:red;width:0%;}
  </style>
</head>
<body>
  <video id="v0" playsinline muted preload="auto">
    <source src="fingers.mp4" type="video/mp4" />
  </video>

  <div id="scrubber2"><div class="scrubber__fill"></div></div>
  <div id="scrubber"><div class="scrubber__fill"></div></div>

  <script>
    const vid = document.getElementById('v0');
    const bar1 = document.getElementById('scrubber');
    const bar2 = document.getElementById('scrubber2');
    const fill1 = bar1.querySelector('.scrubber__fill');
    const fill2 = bar2.querySelector('.scrubber__fill');

    const clamp01 = v => Math.max(0, Math.min(1, v||0));

    function send(p){
      parent.postMessage(JSON.stringify({type:'videoProgress', value:p}), '*');
    }

    function setByRatio(r){
      if (!vid.duration) return;
      const t = clamp01(r) * vid.duration;
      vid.currentTime = t;
      fill1.style.width = (r*100)+'%';
      fill2.style.width = (r*100)+'%';
      send(r);
    }

    function ratioFromX(root,x){
      const rect=root.getBoundingClientRect();
      const dx=Math.min(Math.max(0,x-rect.left),rect.width);
      return rect.width?dx/rect.width:0;
    }

    function onMove(e){
      const x=e.clientX,y=e.clientY;
      [bar1,bar2].forEach(bar=>{
        const r=bar.getBoundingClientRect();
        if(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom){
          setByRatio(ratioFromX(bar,x));
        }
      });
    }
    window.addEventListener('mousemove',onMove);

    // Listen from Wix
    window.addEventListener('message',evt=>{
      let msg={};
      try{msg=JSON.parse(evt.data);}catch{msg=evt.data||{};}
      if(msg.type==='scrollProgress'){
        setByRatio(clamp01(msg.value));
      }
    });
  </script>
</body>
</html>
